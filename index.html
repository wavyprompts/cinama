<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TheWatchList | Personal Archive</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Cpath fill='%23A42EFF' d='M440,120 L120,120 L120,440 L440,440 L440,120 Z M400,160 L400,220 L360,220 L360,160 L400,160 Z M320,160 L320,220 L280,220 L280,160 L320,160 Z M240,160 L240,220 L200,220 L200,160 L240,160 Z M160,160 L160,220 L120,220 L120,160 L160,160 Z M120,400 L120,260 L440,260 L440,400 L120,400 Z' transform='rotate(-10 256 256)'/%3E%3C/svg%3E">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@200;400;700;900&family=Outfit:wght@100;300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --primary: #A42EFF;
            --bg-dark: #050505;
        }
        body {
            background-color: var(--bg-dark);
            color: white;
            font-family: 'Outfit', sans-serif;
            overflow-x: hidden;
        }
        .font-title { font-family: 'Unbounded', sans-serif; }
        .text-gradient-purple {
            background: linear-gradient(135deg, #fff 0%, #A42EFF 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .glass {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(24px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .glass-premium {
            background: rgba(10, 10, 10, 0.6);
            backdrop-filter: blur(40px) saturate(200%);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; height: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(164, 46, 255, 0.3); border-radius: 10px; }
        @keyframes scroll-up { from { transform: translateY(0); } to { transform: translateY(-50%); } }
        @keyframes scroll-down { from { transform: translateY(-50%); } to { transform: translateY(0); } }
        @keyframes fade-in { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes scale-up { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .animate-scroll-up { animation: scroll-up linear infinite; }
        .animate-scroll-down { animation: scroll-down linear infinite; }
        .animate-fade-in { animation: fade-in 1.2s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .animate-scale-up { animation: scale-up 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .glass-input {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.4s ease;
        }
        .glass-input:focus {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(164, 46, 255, 0.3);
            outline: none;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@19.0.0",
            "react-dom": "https://esm.sh/react-dom@19.0.0",
            "react-dom/client": "https://esm.sh/react-dom@19.0.0/client",
            "react-router-dom": "https://esm.sh/react-router-dom@6.28.0?deps=react@19.0.0,react-dom@19.0.0",
            "htm": "https://esm.sh/htm@3.1.1"
        }
    }
    </script>

    <script type="module">
        import React, { useState, useEffect, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import { HashRouter, Routes, Route, Link, useLocation, useNavigate, Navigate } from 'react-router-dom';
        import htm from 'htm';

        const html = htm.bind(React.createElement);

        // --- Icons ---
        const Icons = {
            Home: () => html`<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>`,
            Drama: () => html`<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M7 3v18"/><path d="M17 3v18"/><path d="M3 7h4"/><path d="M3 12h4"/><path d="M3 17h4"/><path d="M17 7h4"/><path d="M17 12h4"/><path d="M17 17h4"/></svg>`,
            Movie: () => html`<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 3h20"/><path d="M21 3v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V3"/><path d="m7 21 5-5 5 5"/></svg>`,
            Anime: () => html`<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></svg>`,
            Settings: () => html`<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33 1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82 1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>`,
            Search: () => html`<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>`
        };

        // --- Configuration ---
        const CATEGORIES = [
            { id: 'kdrama', name: 'K-DRAMA', path: '/kdrama', icon: Icons.Drama },
            { id: 'kmovie', name: 'K-MOVIE', path: '/kmovie', icon: Icons.Movie },
            { id: 'hdrama', name: 'H-DRAMA', path: '/hdrama', icon: Icons.Drama },
            { id: 'hmovie', name: 'H-MOVIE', path: '/hmovie', icon: Icons.Movie },
            { id: 'cdrama', name: 'C-DRAMA', path: '/cdrama', icon: Icons.Drama },
            { id: 'anime', name: 'ANIME', path: '/anime', icon: Icons.Anime }
        ];

        const STATUS_OPTIONS = [
            { value: 'watching', label: 'Watching' },
            { value: 'completed', label: 'Completed' },
            { value: 'plan-to-watch', label: 'Plan to Watch' },
            { value: 'on-hold', label: 'On Hold' },
            { value: 'dropped', label: 'Dropped' }
        ];

        const INITIAL_DATA = [
            { id: "kd001", category: "kdrama", title: "Lovely Runner", year: 2024, poster: "https://images.unsplash.com/photo-1536440136628-849c177e76a1?auto=format&fit=crop&q=80&w=600", myRating: 10, status: "completed", genres: ["Romance", "Fantasy"], watchLink: "https://www.viki.com", trailerUrl: "https://www.youtube.com/watch?v=dQw4w9WgXcQ", dateAdded: new Date().toISOString() },
            { id: "hm001", category: "hmovie", title: "Dune: Part Two", year: 2024, poster: "https://images.unsplash.com/photo-1446776811953-b23d57bd21aa?auto=format&fit=crop&q=80&w=600", myRating: 9, status: "completed", genres: ["Sci-Fi", "Adventure"], watchLink: "https://www.hbomax.com", dateAdded: new Date().toISOString() }
        ];

        // --- Utilities ---
        const getYoutubeEmbed = (url) => {
            if (!url) return null;
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? `https://www.youtube.com/embed/${match[2]}` : null;
        };

        // --- Components ---

        const BottomNav = () => {
            const location = useLocation();
            const navItems = [
                { path: '/', icon: Icons.Home, label: 'Home' },
                { path: '/kdrama', icon: Icons.Drama, label: 'K-Drama' },
                { path: '/hdrama', icon: Icons.Movie, label: 'Hollywood' },
                { path: '/anime', icon: Icons.Anime, label: 'Anime' },
                { path: '/admin', icon: Icons.Settings, label: 'Settings' }
            ];

            return html`
                <div className="fixed bottom-8 left-1/2 -translate-x-1/2 z-[600] w-[90%] max-w-lg lg:hidden">
                    <div className="glass-premium p-4 rounded-[2rem] border border-white/5 shadow-[0_20px_50px_rgba(0,0,0,0.5)] flex items-center justify-around backdrop-blur-3xl">
                        ${navItems.map(item => {
                            const isActive = location.pathname === item.path;
                            return html`
                                <Link key=${item.path} to=${item.path} className=${`flex flex-col items-center gap-1 transition-all duration-300 ${isActive ? 'text-primary scale-110' : 'text-white/40 hover:text-white/70'}`}>
                                    <${item.icon} />
                                    <span className="text-[8px] font-black uppercase tracking-tighter">${item.label}</span>
                                    ${isActive && html`<div className="w-1 h-1 bg-primary rounded-full absolute -bottom-1 shadow-[0_0_8px_var(--primary)]" />`}
                                </Link>
                            `;
                        })}
                    </div>
                </div>
            `;
        };

        const ParallaxWall = ({ posters }) => {
            const columns = useMemo(() => {
                let pool = posters.length > 0 ? posters : ["https://images.unsplash.com/photo-1536440136628-849c177e76a1?auto=format&fit=crop&q=80&w=600"];
                while (pool.length < 40) pool = [...pool, ...pool];
                pool = pool.sort(() => Math.random() - 0.5);
                const cols = [[], [], [], [], []];
                pool.forEach((p, i) => cols[i % 5].push(p));
                return cols;
            }, [posters]);

            return html`
                <div className="absolute inset-0 overflow-hidden pointer-events-none opacity-20 select-none">
                    <div className="flex gap-4 md:gap-8 justify-center items-start w-[140%] -ml-[20%] -mt-[20%] h-[140%] rotate-12 scale-110">
                        ${columns.map((col, i) => html`
                            <div key=${i} className="flex flex-col gap-8 w-48 shrink-0 ${i % 2 === 0 ? 'animate-scroll-up' : 'animate-scroll-down'}" style=${{ animationDuration: `${120 + i * 20}s` }}>
                                ${col.map((src, idx) => html`
                                    <div key=${idx} className="w-full aspect-[2/3] rounded-2xl overflow-hidden glass shadow-2xl">
                                        <img src=${src} className="w-full h-full object-cover opacity-60 grayscale-[0.3]" loading="lazy" />
                                    </div>
                                `)}
                            </div>
                        `)}
                    </div>
                </div>
            `;
        };

        const WatchCard = ({ item, onInfo }) => html`
            <div onClick=${() => onInfo(item.id)} className="group relative rounded-2xl overflow-hidden aspect-[2/3] cursor-pointer bg-black glass border border-white/5 transition-all duration-500 hover:scale-[1.03] hover:border-white/20 active:scale-95">
                <img src=${item.poster} className="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition-opacity duration-700" loading="lazy" />
                <div className="absolute inset-0 bg-gradient-to-t from-black via-black/20 to-transparent opacity-80 group-hover:opacity-90 transition-opacity" />
                <div className="absolute inset-x-0 bottom-0 p-5 transform translate-y-2 group-hover:translate-y-0 transition-transform duration-500">
                    <div className="text-white text-xs font-black uppercase tracking-widest truncate mb-1 shadow-sm">${item.title}</div>
                    <div className="flex justify-between items-center text-[9px] text-white/50 font-bold uppercase tracking-widest">
                        <span>${item.year}</span>
                        <span className="text-[#EDB600]">★ ${item.myRating}</span>
                    </div>
                </div>
            </div>
        `;

        const DetailModal = ({ item, onClose, onEdit }) => {
            if (!item) return null;
            const embedUrl = getYoutubeEmbed(item.trailerUrl);
            
            return html`
                <div className="fixed inset-0 z-[1000] flex items-center justify-center p-4">
                    <div className="absolute inset-0 bg-black/95 backdrop-blur-2xl transition-opacity" onClick=${onClose} />
                    <div className="relative glass-premium w-full max-w-5xl max-h-[92vh] overflow-y-auto rounded-[2.5rem] md:rounded-[4rem] border border-white/10 animate-scale-up custom-scrollbar">
                        <button onClick=${onClose} className="absolute top-6 right-6 md:top-10 md:right-10 w-12 h-12 glass flex items-center justify-center rounded-2xl z-20 hover:bg-white/10 transition-colors">✕</button>
                        <div className="flex flex-col md:flex-row p-8 md:p-16 gap-10 md:gap-16">
                            <div className="w-full md:w-2/5 shrink-0">
                                <div className="rounded-[2rem] md:rounded-[3rem] overflow-hidden shadow-[0_40px_80px_-15px_rgba(0,0,0,0.8)] border border-white/5">
                                    <img src=${item.poster} className="w-full aspect-[2/3] object-cover" />
                                </div>
                            </div>
                            <div className="flex-1 space-y-10 py-4">
                                <div>
                                    <h2 className="font-title text-4xl md:text-7xl font-black uppercase tracking-tighter leading-[0.9] text-gradient-purple mb-6">${item.title}</h2>
                                    <div className="flex flex-wrap gap-3">
                                        <span className="px-5 py-2 glass rounded-2xl text-[10px] font-black uppercase tracking-widest text-primary">${item.category}</span>
                                        <span className="px-5 py-2 glass rounded-2xl text-[10px] font-black uppercase tracking-widest text-[#EDB600]">★ ${item.myRating} / 10</span>
                                        <span className="px-5 py-2 glass rounded-2xl text-[10px] font-black uppercase tracking-widest opacity-60">${item.status}</span>
                                    </div>
                                </div>
                                <div className="space-y-4">
                                    <h3 className="text-[10px] font-black uppercase tracking-[0.3em] opacity-30">Classification</h3>
                                    <p className="text-white/60 text-sm md:text-base leading-relaxed font-light">${item.genres?.join(' • ') || 'No Genres defined.'}</p>
                                </div>
                                <div className="flex gap-4">
                                    <a href=${item.watchLink} target="_blank" className="flex-1 py-6 bg-white text-black font-title text-xs font-black uppercase tracking-widest rounded-[1.5rem] text-center hover:scale-[1.02] active:scale-95 transition-all">Watch Now</a>
                                    <button onClick=${() => onEdit(item.id)} className="w-20 glass rounded-[1.5rem] flex items-center justify-center text-xl hover:bg-white/10 transition-all">✎</button>
                                </div>
                                ${embedUrl && html`
                                    <div className="space-y-6 pt-6">
                                        <h3 className="text-[10px] font-black uppercase tracking-[0.3em] opacity-30">Preview Trailer</h3>
                                        <div className="aspect-video w-full rounded-[2rem] overflow-hidden border border-white/10 glass bg-black/40">
                                            <iframe src=${embedUrl} className="w-full h-full" frameBorder="0" allowFullScreen />
                                        </div>
                                    </div>
                                `}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        };

        const Layout = ({ children }) => {
            const navigate = useNavigate();
            const location = useLocation();
            const [query, setQuery] = useState('');

            const handleSearchSubmit = (e) => {
                e.preventDefault();
                if (query.trim()) {
                    navigate(`/search?q=${encodeURIComponent(query)}`);
                    setQuery('');
                }
            };

            return html`
                <div className="min-h-screen relative flex flex-col">
                    <!-- Top Navigation Bar -->
                    <nav className="fixed top-0 left-0 right-0 z-[500] px-6 py-6 md:px-12 md:py-10">
                        <div className="max-w-7xl mx-auto flex items-center justify-between glass-premium px-8 py-4 md:py-5 rounded-[2rem] border border-white/5 shadow-2xl backdrop-blur-3xl">
                            <Link to="/" className="flex items-center gap-3">
                                <div className="font-title text-xl md:text-2xl font-black tracking-tighter group">
                                    THE<span className="text-primary group-hover:text-white transition-colors duration-500">WATCH</span>LIST
                                </div>
                            </Link>
                            
                            <!-- Desktop Nav Links -->
                            <div className="hidden lg:flex gap-8">
                                ${CATEGORIES.map(cat => html`
                                    <Link key=${cat.id} to=${cat.path} className=${`text-[10px] font-black uppercase tracking-widest transition-all hover:text-white flex items-center gap-2 ${location.pathname === cat.path ? 'text-white' : 'text-white/40'}`}>
                                        ${cat.name}
                                    </Link>
                                `)}
                            </div>

                            <div className="flex items-center gap-6">
                                <form onSubmit=${handleSearchSubmit} className="relative block">
                                    <div className="absolute left-4 top-1/2 -translate-y-1/2 opacity-30">
                                        <${Icons.Search} />
                                    </div>
                                    <input value=${query} onChange=${e => setQuery(e.target.value)} className="glass-input pl-11 pr-6 py-3 rounded-2xl text-[10px] w-32 md:w-48 lg:w-64 font-bold uppercase tracking-widest placeholder:opacity-30" placeholder="Media Search..." />
                                </form>
                                <Link to="/admin" className=${`hidden md:flex w-12 h-12 glass rounded-2xl items-center justify-center text-lg transition-all hover:bg-primary/20 hover:border-primary/30 ${location.pathname === '/admin' ? 'bg-primary/40 border-primary text-white' : 'text-white/60'}`}>
                                    <${Icons.Settings} />
                                </Link>
                            </div>
                        </div>
                    </nav>

                    <!-- Main Content Area -->
                    <main className="flex-1 pt-24 md:pt-40 pb-32 lg:pb-20">${children}</main>
                    
                    <!-- Floating Bottom Navigation (Mobile Only) -->
                    <${BottomNav} />

                    <footer className="py-24 text-center hidden md:block">
                        <div className="opacity-10 text-[10px] font-black tracking-[1.5em] uppercase select-none">Personal Media Archive System v3.1</div>
                    </footer>
                </div>
            `;
        };

        // --- Pages ---

        const Home = ({ items, onInfo }) => {
            const stats = useMemo(() => ({
                total: items.length,
                completed: items.filter(i => i.status === 'completed').length,
                watching: items.filter(i => i.status === 'watching').length
            }), [items]);

            return html`
                <div className="space-y-40">
                    <section className="relative min-h-[85vh] flex flex-col items-center justify-center overflow-hidden px-6">
                        <${ParallaxWall} posters=${items.map(i => i.poster)} />
                        <div className="relative z-10 text-center space-y-16 animate-fade-in">
                            <div className="space-y-4">
                                <div className="text-[10px] font-black uppercase tracking-[1em] text-primary opacity-80 mb-4">Registry 2025</div>
                                <h1 className="font-title text-5xl md:text-[10rem] font-black tracking-tighter leading-[0.85] text-white">THE<br/><span className="text-gradient-purple">ARCHIVE.</span></h1>
                            </div>
                            <div className="inline-flex gap-8 md:gap-24 glass-premium p-8 md:p-14 rounded-[3rem] md:rounded-[4.5rem] border border-white/5 backdrop-blur-3xl shadow-[0_50px_100px_-20px_rgba(0,0,0,0.5)]">
                                <div className="text-center group">
                                    <div className="text-3xl md:text-6xl font-title font-black mb-1">${stats.total}</div>
                                    <div className="text-[8px] md:text-[9px] font-black uppercase tracking-widest opacity-20 group-hover:opacity-100 transition-opacity">Total</div>
                                </div>
                                <div className="w-[1px] h-12 md:h-16 bg-white/10 my-auto" />
                                <div className="text-center group">
                                    <div className="text-3xl md:text-6xl font-title font-black mb-1">${stats.completed}</div>
                                    <div className="text-[8px] md:text-[9px] font-black uppercase tracking-widest opacity-20 group-hover:opacity-100 transition-opacity">Done</div>
                                </div>
                                <div className="w-[1px] h-12 md:h-16 bg-white/10 my-auto" />
                                <div className="text-center group">
                                    <div className="text-3xl md:text-6xl font-title font-black mb-1 text-primary">${stats.watching}</div>
                                    <div className="text-[8px] md:text-[9px] font-black uppercase tracking-widest opacity-20 group-hover:opacity-100 transition-opacity">Active</div>
                                </div>
                            </div>
                        </div>
                    </section>
                    <section className="px-8 md:px-12 max-w-[1920px] mx-auto space-y-16">
                        <div className="flex items-center justify-between">
                            <h2 className="font-title text-2xl md:text-5xl font-black uppercase tracking-tighter">Recently Logged</h2>
                        </div>
                        <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-6 md:gap-10">
                            ${items.slice(0, 16).map(item => html`<${WatchCard} key=${item.id} item=${item} onInfo=${onInfo} />`)}
                        </div>
                    </section>
                </div>
            `;
        };

        const CategoryPage = ({ categoryIds, title, items, onInfo }) => {
            const filtered = items.filter(i => categoryIds.includes(i.category));
            return html`
                <div className="px-8 md:px-12 max-w-[1920px] mx-auto space-y-24 py-10 animate-fade-in">
                    <div className="space-y-4">
                        <div className="text-[10px] font-black uppercase tracking-[0.5em] opacity-30">Category Archive</div>
                        <h1 className="font-title text-5xl md:text-9xl font-black uppercase tracking-tighter leading-tight text-gradient-purple">${title}</h1>
                    </div>
                    <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-6 md:gap-10">
                        ${filtered.length > 0 ? filtered.map(item => html`<${WatchCard} key=${item.id} item=${item} onInfo=${onInfo} />`) : html`<div className="col-span-full py-40 text-center opacity-20 font-black uppercase tracking-widest">No entries found for this category.</div>`}
                    </div>
                </div>
            `;
        };

        const SearchResults = ({ items, onInfo }) => {
            const query = new URLSearchParams(useLocation().search).get('q')?.toLowerCase() || '';
            const filtered = items.filter(i => i.title.toLowerCase().includes(query) || i.genres?.some(g => g.toLowerCase().includes(query)));
            
            return html`
                <div className="px-8 md:px-12 max-w-[1920px] mx-auto space-y-24 py-10 animate-fade-in">
                    <div className="space-y-4">
                        <div className="text-[10px] font-black uppercase tracking-[0.5em] opacity-30">Database Query Results</div>
                        <h1 className="font-title text-4xl md:text-8xl font-black uppercase tracking-tighter leading-tight">"${query}"</h1>
                    </div>
                    <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-6 md:gap-10">
                        ${filtered.length > 0 ? filtered.map(item => html`<${WatchCard} key=${item.id} item=${item} onInfo=${onInfo} />`) : html`<div className="col-span-full py-40 text-center opacity-20 font-black uppercase tracking-widest">No results matched your search.</div>`}
                    </div>
                </div>
            `;
        };

        const Admin = ({ items, onAdd, onUpdate, onDelete }) => {
            const [formData, setFormData] = useState({ title: '', category: 'kdrama', poster: '', watchLink: '', trailerUrl: '', year: 2024, myRating: 8, status: 'plan-to-watch', genres: '' });
            const [editId, setEditId] = useState(null);

            const handleSubmit = (e) => {
                e.preventDefault();
                const genresArr = formData.genres.split(',').map(g => g.trim()).filter(Boolean);
                const submission = { ...formData, genres: genresArr };
                if (editId) onUpdate(editId, submission);
                else onAdd(submission);
                setFormData({ title: '', category: 'kdrama', poster: '', watchLink: '', trailerUrl: '', year: 2024, myRating: 8, status: 'plan-to-watch', genres: '' });
                setEditId(null);
            };

            const startEdit = (item) => {
                setFormData({ ...item, genres: item.genres?.join(', ') || '' });
                setEditId(item.id);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            return html`
                <div className="max-w-6xl mx-auto px-6 space-y-32 pb-40 animate-fade-in">
                    <div className="text-center space-y-4">
                        <div className="text-[10px] font-black uppercase tracking-[0.5em] opacity-30">System Configuration</div>
                        <h1 className="font-title text-5xl md:text-7xl font-black uppercase tracking-tighter">DATA<span className="text-primary">CENTER</span></h1>
                    </div>

                    <form onSubmit=${handleSubmit} className="glass-premium p-10 md:p-16 rounded-[3rem] border border-white/5 space-y-12 shadow-2xl">
                        <div className="grid md:grid-cols-2 gap-10">
                            <div className="space-y-8">
                                <div className="space-y-2">
                                    <label className="text-[9px] font-black uppercase tracking-widest opacity-30 px-2">Media Title</label>
                                    <input required value=${formData.title} onChange=${e => setFormData({...formData, title: e.target.value})} className="glass-input w-full p-6 rounded-[1.5rem] text-xs font-black uppercase tracking-widest" placeholder="Enter Full Title" />
                                </div>
                                <div className="grid grid-cols-2 gap-6">
                                    <div className="space-y-2">
                                        <label className="text-[9px] font-black uppercase tracking-widest opacity-30 px-2">Category</label>
                                        <select value=${formData.category} onChange=${e => setFormData({...formData, category: e.target.value})} className="glass-input w-full p-6 rounded-[1.5rem] text-[10px] font-black uppercase tracking-widest bg-black/80">
                                            ${CATEGORIES.map(c => html`<option key=${c.id} value=${c.id}>${c.name}</option>`)}
                                        </select>
                                    </div>
                                    <div className="space-y-2">
                                        <label className="text-[9px] font-black uppercase tracking-widest opacity-30 px-2">Current Status</label>
                                        <select value=${formData.status} onChange=${e => setFormData({...formData, status: e.target.value})} className="glass-input w-full p-6 rounded-[1.5rem] text-[10px] font-black uppercase tracking-widest bg-black/80">
                                            ${STATUS_OPTIONS.map(s => html`<option key=${s.value} value=${s.value}>${s.label}</option>`)}
                                        </select>
                                    </div>
                                </div>
                                <div className="space-y-2">
                                    <label className="text-[9px] font-black uppercase tracking-widest opacity-30 px-2">Poster Source (HTTPS URL)</label>
                                    <input required value=${formData.poster} onChange=${e => setFormData({...formData, poster: e.target.value})} className="glass-input w-full p-6 rounded-[1.5rem] text-[10px] font-bold" placeholder="https://..." />
                                </div>
                            </div>
                            <div className="space-y-8">
                                <div className="grid grid-cols-2 gap-6">
                                    <div className="space-y-2">
                                        <label className="text-[9px] font-black uppercase tracking-widest opacity-30 px-2">Rating</label>
                                        <input type="number" min="0" max="10" value=${formData.myRating} onChange=${e => setFormData({...formData, myRating: e.target.value})} className="glass-input w-full p-6 rounded-[1.5rem] text-xs font-black" />
                                    </div>
                                    <div className="space-y-2">
                                        <label className="text-[9px] font-black uppercase tracking-widest opacity-30 px-2">Release Year</label>
                                        <input type="number" value=${formData.year} onChange=${e => setFormData({...formData, year: e.target.value})} className="glass-input w-full p-6 rounded-[1.5rem] text-xs font-black" />
                                    </div>
                                </div>
                                <div className="space-y-2">
                                    <label className="text-[9px] font-black uppercase tracking-widest opacity-30 px-2">Watch Link</label>
                                    <input required value=${formData.watchLink} onChange=${e => setFormData({...formData, watchLink: e.target.value})} className="glass-input w-full p-6 rounded-[1.5rem] text-[10px] font-bold" placeholder="Streaming Platform URL" />
                                </div>
                                <div className="space-y-2">
                                    <label className="text-[9px] font-black uppercase tracking-widest opacity-30 px-2">Trailer URL (YouTube)</label>
                                    <input value=${formData.trailerUrl} onChange=${e => setFormData({...formData, trailerUrl: e.target.value})} className="glass-input w-full p-6 rounded-[1.5rem] text-[10px] font-bold" placeholder="Optional" />
                                </div>
                            </div>
                            <div className="md:col-span-2 space-y-2">
                                <label className="text-[9px] font-black uppercase tracking-widest opacity-30 px-2">Genre Tags (Comma Separated)</label>
                                <input value=${formData.genres} onChange=${e => setFormData({...formData, genres: e.target.value})} className="glass-input w-full p-6 rounded-[1.5rem] text-[10px] font-black uppercase tracking-widest" placeholder="e.g. Action, Romance, Thriller" />
                            </div>
                        </div>
                        <button type="submit" className="w-full py-8 bg-white text-black font-title text-sm font-black uppercase tracking-[0.2em] rounded-[2rem] shadow-xl hover:scale-[1.01] active:scale-95 transition-all">
                            ${editId ? 'Apply Database Changes' : 'Initialize New Entry'}
                        </button>
                    </form>

                    <div className="space-y-8">
                        <h2 className="font-title text-2xl font-black uppercase tracking-widest opacity-20">Database Registry</h2>
                        <div className="grid gap-6">
                            ${items.map(item => html`
                                <div key=${item.id} className="glass-premium p-6 rounded-[2rem] flex items-center justify-between border border-white/5 hover:border-white/10 transition-colors">
                                    <div className="flex items-center gap-8">
                                        <img src=${item.poster} className="w-16 h-24 object-cover rounded-xl shadow-lg" />
                                        <div>
                                            <div className="text-sm font-black uppercase tracking-widest text-white/90">${item.title}</div>
                                            <div className="text-[10px] text-white/30 font-black uppercase tracking-widest mt-2">${item.category} • ${item.year} • ★ ${item.myRating}</div>
                                            <div className="flex gap-2 mt-2">
                                                ${item.genres?.slice(0, 3).map(g => html`<span className="text-[8px] opacity-20 border border-white/10 px-2 py-0.5 rounded-full uppercase font-black">${g}</span>`)}
                                            </div>
                                        </div>
                                    </div>
                                    <div className="flex gap-4 px-4">
                                        <button onClick=${() => startEdit(item)} className="w-12 h-12 glass rounded-xl flex items-center justify-center text-primary text-xs font-black uppercase hover:bg-white/5">Edit</button>
                                        <button onClick=${() => { if(confirm('Purge entry?')) onDelete(item.id) }} className="w-12 h-12 glass rounded-xl flex items-center justify-center text-red-500 text-xs font-black uppercase hover:bg-white/5">Del</button>
                                    </div>
                                </div>
                            `)}
                        </div>
                    </div>
                </div>
            `;
        };

        const App = () => {
            const [items, setItems] = useState([]);
            const [selectedId, setSelectedId] = useState(null);
            const [loaded, setLoaded] = useState(false);

            useEffect(() => {
                const stored = localStorage.getItem('watchlist_final_v3_nav');
                setItems(stored ? JSON.parse(stored) : INITIAL_DATA);
                setLoaded(true);
            }, []);

            useEffect(() => {
                if (loaded) localStorage.setItem('watchlist_final_v3_nav', JSON.stringify(items));
            }, [items, loaded]);

            const onAdd = (item) => setItems([{ ...item, id: Math.random().toString(36).substr(2, 9), dateAdded: new Date().toISOString() }, ...items]);
            const onUpdate = (id, data) => setItems(items.map(i => i.id === id ? { ...i, ...data } : i));
            const onDelete = (id) => setItems(items.filter(i => i.id !== id));

            if (!loaded) return html`<div className="min-h-screen bg-black flex items-center justify-center font-title text-xs tracking-[1.5em] opacity-20">BOOTING ARCHIVE...</div>`;

            return html`
                <${HashRouter}>
                    <${Layout}>
                        <${Routes}>
                            <${Route} path="/" element=${html`<${Home} items=${items} onInfo=${setSelectedId} />`} />
                            <${Route} path="/kdrama" element=${html`<${CategoryPage} categoryIds=${['kdrama', 'kmovie']} title="K-ARCHIVE" items=${items} onInfo=${setSelectedId} />`} />
                            <${Route} path="/hdrama" element=${html`<${CategoryPage} categoryIds=${['hdrama', 'hmovie']} title="HOLLYWOOD" items=${items} onInfo=${setSelectedId} />`} />
                            <${Route} path="/cdrama" element=${html`<${CategoryPage} categoryIds=${['cdrama']} title="C-DRAMA" items=${items} onInfo=${setSelectedId} />`} />
                            <${Route} path="/anime" element=${html`<${CategoryPage} categoryIds=${['anime']} title="ANIME" items=${items} onInfo=${setSelectedId} />`} />
                            <${Route} path="/admin" element=${html`<${Admin} items=${items} onAdd=${onAdd} onUpdate=${onUpdate} onDelete=${onDelete} />`} />
                            <${Route} path="/search" element=${html`<${SearchResults} items=${items} onInfo=${setSelectedId} />`} />
                            <${Route} path="*" element=${html`<${Navigate} to="/" />`} />
                        <//>
                        <${DetailModal} item=${items.find(i => i.id === selectedId)} onClose=${() => setSelectedId(null)} onEdit=${(id) => { setSelectedId(null); window.location.hash = '#/admin'; }} />
                    <//>
                <//>
            `;
        };

        const root = createRoot(document.getElementById('root'));
        root.render(html`<${App} />`);
    </script>
</body>
</html>